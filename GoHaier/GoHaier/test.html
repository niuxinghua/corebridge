
<html lang="zh-CN">
    <body onload="registerHandlers()">
        
        <div>
            iOS load html by webview
        </div>
        <button type="button" onclick="loadImage()">select image!</button>
        <button type="button" onclick="takePhoto()">take photo!</button>
        <button type="button" onclick="barCode()">barCode scan!</button>
        <div id="myDiv" height:100px;width:100px>
        </div>
        
        <script>
            function addImage(image)
            {
                var bigImg = document.createElement("img");//创建一个img元素
                bigImg.src="data:image/png;base64," + image;
                bigImg.height = 300;
                bigImg.width = 300;
                //给img元素的src属性赋值
                var myDiv = document.getElementById('myDiv');//获得dom对象
                // myDiv.empty();
                var childs = myDiv.childNodes;
                for(var i=childs.length-1; i>=0; i--){
                    myDiv.removeChild(childs.item(i));
                }
                myDiv.appendChild(bigImg);
            }
        function connectWebViewJavascriptBridge(callback) {
            if (window.WebViewJavascriptBridge) {
                callback(WebViewJavascriptBridge)
            } else {
                document.addEventListener('WebViewJavascriptBridgeReady', function() {
                                          callback(WebViewJavascriptBridge)
                                          }, false)
            }
        }
        
        connectWebViewJavascriptBridge(function(bridge) {

                                       bridge.init(function(message, responseCallback) {
                                                   
                                                   })
                                       
                                       bridge.registerHandler('imageData', function(data, responseCallback) {
                                                              addImage(data.image)
                                                              
                                                              })
                                       
                                       
                                       })
                                       
                                       function loadImage()
                                       {
                                           connectWebViewJavascriptBridge(function(bridge) {
                                                                          
                                                                          
                                                                          bridge.callHandler('haier_choose_photo', "", function(response) {
                                                                                             
                                                                                           alert(response)

                                                                                             })
                                                                          
                                                                          
                                                                          })
                                                                          
                                       }
        
        
        
        function takePhoto()
        {
            connectWebViewJavascriptBridge(function(bridge) {
                                           
                                           
                                           bridge.callHandler('haier_take_photo', "", function(response) {
                                                              
                                                              
                                                              
                                                              })
                                           
                                           
                                           })
                                           
        }
        
        function barCode()
        {
            connectWebViewJavascriptBridge(function(bridge) {
                                           
                                           
                                           bridge.callHandler('haier_scan_qrcode', "", function(response) {
                                                              
                                                              
                                                              
                                                              })
                                           
                                           
                                           })
                                           
        }
        
            </script>
    </body>
</html>
